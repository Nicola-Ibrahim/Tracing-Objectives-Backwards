\begin{tikzpicture}[
    % --- Local configuration for this picture only ---
    execute at begin picture={
        % Local colour definitions
        \definecolor{colDecision}{RGB}{65,117,252}  % Blue
        \definecolor{colObjective}{RGB}{255,88,93}  % Red
        \definecolor{colModel}{RGB}{100,100,110}   % Grey
        \definecolor{bgFill}{RGB}{255,255,255}     % Light Background
    },
    % --- Global Styles ---
    font=\sffamily,
    >=Latex,
    spaceBlob/.style={
        fill=white, draw=#1, line width=1pt, densely dashed,
        rounded corners=15pt, opacity=0.8
    },
    point/.style={
        circle, inner sep=0pt, minimum size=5pt, fill=#1, draw=white, line width=0.5pt
    },
    modelBox/.style={
        rectangle, draw=colModel, line width=1pt, rounded corners=4pt, 
        fill=white, inner sep=8pt, align=center, drop shadow={opacity=0.1}
    },
    arrowMain/.style={->, line width=1.2pt, draw=colModel},
    arrowCheck/.style={->, line width=0.8pt, dashed, draw=colModel!80},
    labelSpace/.style={font=\bfseries\small, text=#1}
]

% =================================================================================
% TOP PANEL: FORWARD PROBLEM
% =================================================================================

\begin{scope}[yshift=4cm]

% Bounding box for panel (more padding inside)
\node[draw=none, fill=bgFill, rounded corners=10pt,
      minimum width=10cm, minimum height=7.2cm] (PanelL) at (0,0) {};
\node[anchor=north west, font=\large\bfseries, text=colModel]
      at ([xshift=4pt,yshift=-4pt]PanelL.north west) {Forward Problem};
% \node[anchor=north west, font=\footnotesize\itshape, text=colModel, yshift=-6mm]
%       at (PanelL.north west) {Evaluation / Simulation};

% Decision Space X (Left) – pushed further left & down
\draw[spaceBlob=colDecision] (-3.0,-0.4) ellipse (1.8cm and 2.3cm);
\node[labelSpace=colDecision] at (-3.0, 2.1) {Decision Space $\mathcal{X}$};
\node[font=\scriptsize, text=colDecision] at (-3.0, -3.4) {Parameters / Design};

% Objective Space Y (Right) – pushed further right & down
\draw[spaceBlob=colObjective] (3.0,-0.4) ellipse (1.8cm and 2.3cm);
\node[labelSpace=colObjective] at (3.0, 2.1) {Objective Space $\mathcal{Y}$};
\node[font=\scriptsize, text=colObjective] at (3.0, -3.4) {Performance / Metrics};

% Mapping points – keep nice gap to box
\node[point=colDecision, label={left:\small $x$}] (x_fwd) at (-3.0, 0.4) {};
\node[point=colObjective, label={right:\small $y$}] (y_fwd) at (3.0, 0.4) {};

% Function Box – centred with more space around
\node[modelBox, font=\small, minimum width=2.5cm] (f_func) at (0, 0.4)
      {$f(\mathbf{x})$\\{\scriptsize Simulator}};

% Arrows
\draw[arrowMain] (x_fwd) -- (f_func);
\draw[arrowMain] (f_func) -- (y_fwd);

% Annotation – further below
\node[align=center, font=\scriptsize, text=colModel, anchor=north]
      at (0, -2.6) {Well-posed\\(Unique Outcome)};

\end{scope}

% =================================================================================
% BOTTOM PANEL: INVERSE PROBLEM
% (same yshift as before -> same gap between panels)
% =================================================================================

\begin{scope}[yshift=-4cm]

% Bounding box for panel (more padding inside)
\node[draw=none, fill=bgFill, rounded corners=10pt,
      minimum width=11cm, minimum height=7.2cm] (PanelR) at (0,0) {};
\node[anchor=north west, font=\large\bfseries, text=colModel]
      at ([xshift=4pt,yshift=-4pt]PanelR.north west) {Inverse Design};
% \node[anchor=north west, font=\footnotesize\itshape, text=colModel, yshift=-6mm]
%       at (PanelR.north west) {Exploration / Reconstruction};

% Objective/Target Space Y (Left) – more left & a bit up
\draw[spaceBlob=colObjective] (-3.2,-0.4) ellipse (1.8cm and 2.3cm);
\node[labelSpace=colObjective] at (-3.2, 2.1) {Objective Space $\mathcal{Y}$};

% Decision/Candidate Space X (Right) – more right & a bit up
\draw[spaceBlob=colDecision] (3.2,-0.4) ellipse (1.8cm and 2.3cm);
\node[labelSpace=colDecision] at (3.2, 2.1) {Decision Space $\mathcal{X}$};

% Target point – with more room above box
\node[point=colObjective, label={left:\small $y^\star$}] (target) at (-3.2, 0.9) {};

% Inverse Model – slightly higher to clear feedback loop
\node[modelBox, minimum width=3.0cm] (inv_model) at (0, 0.9)
      {$\hat{g}(\mathbf{y})$\\{\scriptsize Inverse Model}};

% Data Input – higher
\node[cylinder, shape border rotate=90, draw=gray, fill=white,
      aspect=0.25, minimum height=1.0cm, minimum width=1.0cm,
      font=\scriptsize] (db) at (0, 2.6) {$\mathcal{D}$};
\draw[->, dotted, thick] (db) -- (inv_model)
      node[midway, right, font=\tiny] {Training};

% One-to-many outputs – spread horizontally and vertically
\node[point=colDecision, label={right:\scriptsize $x^{(1)}$}] (c1) at (3.0, 1.2) {};
\node[point=colDecision, label={right:\scriptsize $x^{(2)}$}] (c2) at (3.4, 0.2) {};

% Arrows Forward
\draw[arrowMain] (target) -- (inv_model);
\draw[arrowMain] (inv_model.east) -- (c1.west);
\draw[arrowMain] (inv_model.east) -- (c2.west);

% The Feedback Loop (Forward Consistency) – clearly separated
\node[modelBox, scale=0.8, fill=bgFill!90!gray, minimum width=3.3cm]
      (f_check) at (0, -1.9)
      {Forward Check $\hat{f}(\mathbf{x})$};

% Paths for feedback – longer, smoother curves
\draw[arrowCheck] (c1.south) to[out=250,in=5] (f_check.east);
\draw[arrowCheck] (c2.south) to[out=260,in=5] (f_check.east);

% Result of check – more left
\node[point=colObjective, fill=white, draw=colObjective,
      label={left:\scriptsize $\hat{y}$}] (y_hat) at (-3.0, -1.9) {};
\draw[arrowCheck] (f_check) -- (y_hat);

% Comparison Line – longer
\draw[<->, densely dotted, thick, orange] (target) -- (y_hat)
  node[midway, left, font=\tiny, align=right] {Error\\Minimize $\mathcal{L}$};

% Annotation – pushed further down but still inside panel
\node[align=center, font=\scriptsize, text=colModel, anchor=north]
      at (0, -3.3)
      {Ill-posed (One-to-Many)\\Requires \textbf{Forward Consistency}};

\end{scope}

\end{tikzpicture}
