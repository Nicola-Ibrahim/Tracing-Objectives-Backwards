\begin{tikzpicture}[
    % --- Local Setup ---
    execute at begin picture={
        \definecolor{colInv}{RGB}{0, 119, 182}
        \definecolor{colParam}{RGB}{72, 149, 239}
        \definecolor{colMix}{RGB}{114, 9, 183}
    },
    >=Stealth, thick, node distance=1cm,
    font=\sffamily\footnotesize,
    % --- Styles ---
    io/.style={draw, fill=white, minimum width=1.5cm, minimum height=0.6cm, rounded corners=2pt},
    block/.style={draw, fill=colInv!10, text=colInv, minimum width=2.5cm, minimum height=1cm, font=\sffamily\bfseries\footnotesize, rounded corners=4pt},
    param/.style={draw=colParam, fill=colParam!10, text=colParam!80!black, minimum width=1.2cm, minimum height=0.6cm, rounded corners=2pt, font=\sffamily\scriptsize\bfseries},
    dist/.style={draw=colMix, fill=colMix!10, text=colMix, minimum width=3cm, minimum height=0.8cm, rounded corners=10pt}
]

    % Nodes
    \node[io] (input) {Outcome $\mathbf{y}$};
    \node[block, below=0.8cm of input] (nn) {Neural Network\\(Backbone)};
    
    % Parameter Heads
    \node[param, below=1cm of nn] (mu) {Means $\mu_k(\mathbf{y})$};
    \node[param, left=0.4cm of mu] (pi) {Weights $\pi_k(\mathbf{y})$};
    \node[param, right=0.4cm of mu] (sigma) {Covars $\Sigma_k(\mathbf{y})$};
    
    % Sampling Logic
    \node[dist, below=1cm of mu] (mix) {Gaussian Mixture Model\\$q_\theta(\mathbf{x}|\mathbf{y}) = \sum \pi_k \mathcal{N}(\mu_k, \Sigma_k)$};
    \node[io, below=0.8cm of mix, fill=colInv, text=white, font=\sffamily\bfseries\footnotesize] (output) {Sampled Decision $\hat{\mathbf{x}}$};

    % Path Labels
    \node[right=0.1cm of pi, xshift=-0.5cm, yshift=0.5cm, font=\tiny, text=gray] {Softmax};
    \node[right=0.1cm of sigma, xshift=-0.5cm, yshift=0.5cm, font=\tiny, text=gray] {Exp / Softplus};

    % Connections
    \draw[->] (input) -- (nn);
    \draw[->] (nn.south) -- ++(0,-0.4) -| (pi.north);
    \draw[->] (nn.south) -- (mu.north);
    \draw[->] (nn.south) -- ++(0,-0.4) -| (sigma.north);
    
    \draw[->] (pi.south) -- ++(0,-0.2) -| ([xshift=-1cm]mix.north);
    \draw[->] (mu.south) -- (mix.north);
    \draw[->] (sigma.south) -- ++(0,-0.2) -| ([xshift=1cm]mix.north);
    
    \draw[->, dashed] (mix) -- node[right, font=\tiny\itshape] {Sampling} (output);

\end{tikzpicture}